import tkinter as tk
from tkinter import ttk, filedialog, messagebox
from scanner import escanear_ips
from updater import atualizar_agenda
from config import SAIDA_CSV
import os

class AgendaApp:
    def __init__(self, root):
        self.root = root
        root.title("Atualiza√ß√£o de Agenda")
        root.geometry("400x300")
        root.resizable(False, False)

        # Estilo ttk
        style = ttk.Style()
        style.configure("TButton", font=("Segoe UI", 11), padding=8)
        style.configure("TLabel", font=("Segoe UI", 10))

        # Frame principal
        self.frame = ttk.Frame(root, padding=10)
        self.frame.pack(expand=True, fill="both")

        # T√≠tulo
        ttk.Label(self.frame, text="üìã Atualiza√ß√£o de Agenda", font=("Segoe UI", 14, "bold")).pack(pady=(0, 20))

        # Bot√µes
        self.btn_escanear = ttk.Button(self.frame, text="üñ•Ô∏è Escanear IPs", command=self.escanear)
        self.btn_escanear.pack(fill="x", pady=5)

        self.btn_csv = ttk.Button(self.frame, text="üìÑ Mostrar arquivo CSV", command=self.mostrar_csv)
        self.btn_csv.pack(fill="x", pady=5)

        self.btn_xml = ttk.Button(self.frame, text="üìÇ Selecionar agenda XML", command=self.selecionar_xml)
        self.btn_xml.pack(fill="x", pady=5)

        self.btn_atualizar = ttk.Button(self.frame, text="üöÄ Atualizar agenda", command=self.atualizar)
        self.btn_atualizar.pack(fill="x", pady=5, expand=True)

        # Vari√°veis
        self.ips = []
        self.xml_path = None

    def escanear(self):
        try:
            self.ips = escanear_ips()
            messagebox.showinfo("‚úî Sucesso", f"{len(self.ips)} IPs encontrados.")
        except Exception as e:
            messagebox.showerror("‚ùå Erro", str(e))

    def mostrar_csv(self):
        if not os.path.exists(SAIDA_CSV):
            messagebox.showwarning("‚ö† Aviso", "CSV ainda n√£o gerado.")
            return
        os.startfile(SAIDA_CSV)

    def selecionar_xml(self):
        path = filedialog.askopenfilename(filetypes=[("XML files", "*.xml")])
        if path:
            self.xml_path = path
            messagebox.showinfo("‚úî Selecionado", f"Arquivo XML: {os.path.basename(path)}")

    def atualizar(self):
        if not self.ips:
            messagebox.showwarning("‚ö† Aviso", "Nenhum IP dispon√≠vel. Escaneie primeiro.")
            return
        if not self.xml_path:
            messagebox.showwarning("‚ö† Aviso", "Selecione o arquivo XML.")
            return
        atualizar_agenda(self.ips)

if __name__ == "__main__":
    root = tk.Tk()
    app = AgendaApp(root)
    root.mainloop()
